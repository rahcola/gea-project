# SYNOPSIS:
#
#   make [all]  - makes everything.
#   make TARGET - makes the given target.
#   make clean  - removes all files generated by make.

# Operating system
OS = POSIX

# Flags passed to the preprocessor.
CPPFLAGS += -lrt

# Flags passed to the C++ compiler.
CXXFLAGS += -g -Wall -Wextra --pedantic

# Time
TIME_OBJ = clock.o timer.o
TIME_SRC = src/time
TIME_CPPFLAGS = -lrt

clock.o : $(TIME_SRC)/clock.cc
	$(CXX) $(TIME_CPPFLAGS) $(CXXFLAGS) -D$(OS) -c -o $@ $<

timer.o : $(TIME_SRC)/timer.cc clock.o
	$(CXX) $(TIME_CPPFLAGS) $(CXXFLAGS) -D$(OS) -c -o $@ $<

# Demo
DEMO_OBJ = demo.o cli_demo.o
DEMO_SRC = src/demo
DEMO_CPPFLAGS = -Isrc/time -lglut

demo.o : $(DEMO_SRC)/demo.c $(TIME_OBJ)
	$(CXX) $(DEMO_CPPFLAGS) $(CXXFLAGS) -c -o $@ $<

cli_demo.o : $(DEMO_SRC)/cli_demo.cc $(TIME_OBJ)
	$(CXX) $(DEMO_CPPFLAGS) $(CXXFLAGS) -c -o $@ $<

demo : demo.o $(TIME_OBJ)
	$(CXX) $(DEMO_CPPFLAGS) $(CXXFLAGS) -D$(OS) $^ -o $@

cli_demo : cli_demo.o $(TIME_OBJ)
	$(CXX) $(DEMO_CPPFLAGS) $(CXXFLAGS) -D$(OS) $^ -o $@

# Clean
clean :
	rm $(TIME_OBJ) $(DEMO_OBJ) demo cli_demo
